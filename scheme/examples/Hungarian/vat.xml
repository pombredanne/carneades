<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="file:/Users/tgo/Documents/Projects/Carneades/dist/schemas/LKIF.rnc" type="compact"?>
<lkif>
<!-- *********************************************************************** -->
<!-- PART I. - Is the vendor liable for paying VAT for a given selling    -->
	<rule id="vendorIsLiableForPayingVAT">
		<body>
			<s>vendorOf ?Selling ?Vendor</s>
			
			<s>isDistanceSelling ?Selling</s>
			<s>isTaxablePersonInAMemberState ?Vendor</s>
			<s>hasEuropeanTaxNumber ?Vendor</s>
		</body>
		<head>
			<s>isLiableForPayingVATFor ?Selling ?Vendor</s>
		</head>
	</rule>
	
	<rule id="fact_1"><s>vendorOf Selling Vendor</s></rule>
	<rule id="fact_3"><s>isTaxablePersonInAMemberState Vendor</s></rule>
	<rule id="fact_4"><s>hasEuropeanTaxNumber Vendor</s></rule>

	<rule id="isDistanceSelling">
		<body>
			<s>vendorOf ?Selling ?Vendor</s>
			<s>acquirerOf ?Selling ?Acquirer</s>
			<s>goodsOf ?Selling ?Goods</s>
			<s>memberStateOf ?Vendor ?SourceCountry</s>
			<s>memberStateOf ?Acquirer ?TargetCountry</s>
			
			<s>isSpecialAcquirer ?Acquirer</s>
			<s>notTransportedBy ?Acquirer ?Selling</s>
			<not><s>areSpecialGoods ?Goods</s></not>
			
			<not><s>equals ?SourceCountry ?TargetCountry</s></not>
		</body>
		<head>
			<s>isDistanceSelling ?Selling</s>
		</head>
	</rule>
	
	<rule id="fact_5"><s>acquirerOf Selling Acquirer</s></rule>
	<rule id="fact_6"><s>goodsOf Selling Goods</s></rule>
	<rule id="fact_7"><s>memberStateOf Vendor Hungary</s></rule>
	<rule id="fact_8"><s>memberStateOf Acquirer Austria</s></rule>
	
	<rule id="equals">
		<body>
			<s>eval #t <s>eq? '?x '?y</s></s>
		</body>
		<head>
			<s>equals ?x ?y</s>
		</head>
	</rule>
	<rule id="not_equals">
		<body>
			<s>eval #f <s>eq? '?x '?y</s></s>
		</body>
		<head>
			<not><s>equals ?x ?y</s></not>
		</head>
	</rule>

	<rule id="isSpecialAcquirer_1">
		<body>
			<not><s>isTaxablePersonInAMemberState ?Acquirer</s></not>
		</body>
		<head>
			<s>isSpecialAcquirer ?Acquirer</s>
		</head>
	</rule>
	<rule id="fact_13"><not><s>isTaxablePersonInAMemberState Acquirer</s></not></rule>
	
	<rule id="isSpecialAcquirer_2">
		<body>
			<s>isSpecialTaxablePerson ?Acquirer</s>
		</body>
		<head>
			<s>isSpecialAcquirer ?Acquirer</s>
		</head>
	</rule>
	

<!--**	<rule id="notTransportedBy_1">
		<body>
			<s>acquirerOf ?Selling ?Acquirer</s>
			<s>vendorOf ?Selling ?Vendor</s>
			
			<s>transporterOf ?Selling ?Vendor</s>
		</body>
		<head>
			<s>notTransportedBy ?Acquirer ?Selling</s>
		</head>
	</rule>
-->
<!--** <rule id="fact_15"><s>transporterOf Selling Vendor</s></rule> -->
	
	<rule id="notTransportedBy_2">
		<body>
			<s>vendorOf ?Selling ?Vendor</s>
			<s>acquirerOf ?Selling ?Acquirer</s>
			<s>transporterOf ?Selling ?Transporter</s>
			
			<s>actsOnBehalfOf ?Vendor ?Transporter</s>
			<not><s>equals ?Transporter ?Vendor</s></not>
			<not><s>equals ?Transporter ?Acquirer</s></not>
		</body>
		<head>
			<s>notTransportedBy ?Acquirer ?Selling</s>
		</head>
	</rule>
	<rule id="fact_16"><s>transporterOf Selling Transporter</s></rule>
	<rule id="fact_17"><s>actsOnBehalfOf Vendor Transporter</s></rule>


	<rule id="isSpecialTaxablePerson_1">
		<body>
			<s>carriesOutOnlyTheSellingOrServicesThatAreNotDeductible ?Person</s>
		</body>
		<head>
			<s>isSpecialTaxablePerson ?Person</s>
		</head>
	</rule>
	<rule id="fact_20"><s>carriesOutOnlyTheSellingOrServicesThatAreNotDeductible Acquirer</s></rule>
	
	<rule id="isSpecialTaxablePerson_2">
		<body>
			<s>isEngagedInAgriculturalActivitiesAndIsEntitledToSpecialLegalStatusIfAcquiringTheGoodsForSuchActivities ?Person</s>
		</body>
		<head>
			<s>isSpecialTaxablePerson ?Person</s>
		</head>
	</rule>
	<rule id="fact_21"><s>isEngagedInAgriculturalActivitiesAndIsEntitledToSpecialLegalStatusIfAcquiringTheGoodsForSuchActivities Acquirer</s></rule>

	<rule id="isSpecialTaxablePerson_3">
		<body>
			<s>isNon-taxableLegalPerson ?Person</s>
		</body>
		<head>
			<s>isSpecialTaxablePerson ?Person</s>
		</head>
	</rule>
	<rule id="fact_22"><s>isNon-taxableLegalPerson Acquirer</s></rule>
	
	<rule id="isSpecialTaxablePerson_4">
		<body>
			<s>isEligibleForIndividualTaxExemption ?Person</s>
		</body>
		<head>
			<s>isSpecialTaxablePerson ?Person</s>
		</head>
	</rule>
	<rule id="fact_23"><s>isEligibleForIndividualTaxExemption Acquirer</s></rule>


	<rule id="areSpecialGoods_1">
		<body>
			<s>areNewMeansOfTransport ?Goods</s>
		</body>
		<head>
			<s>areSpecialGoods ?Goods</s>
		</head>
	</rule>
	<rule id="areSpecialGoods_2">
		<body>
			<s>areGoodsIntendedForInstallationOrAssembly ?Goods</s>
		</body>
		<head>
			<s>areSpecialGoods ?Goods</s>
		</head>
	</rule>
	
	<rule id="not_AreSpecialGoods">
		<body>
			<not><s>areNewMeansOfTransport ?Goods</s></not>
			<not><s>areGoodsIntendedForInstallationOrAssembly ?Goods</s></not>
		</body>
		<head>
			<not><s>areSpecialGoods ?Goods</s></not>
		</head>
	</rule>
	<rule id="fact_24"><not><s>areNewMeansOfTransport Goods</s></not></rule>
	<rule id="fact_25"><not><s>areGoodsIntendedForInstallationOrAssembly Goods</s></not></rule>
	
<!-- *********************************************************************** -->
<!-- PART II. - If he is, where should he pay it?                            -->

	<rule id="_isLiableForPayingVATFor"><s>_isLiableForPayingVATFor Selling Vendor</s></rule>

	<rule id="placeOfPayingVAT_targetCountry_1">
		<body>
			<s>vendorOf ?Selling ?Vendor</s>
			<s>acquirerOf ?Selling ?Acquirer</s>
			<s>memberStateOf ?Acquirer ?TargetCountry</s>
			
			<s>_isLiableForPayingVATFor ?Selling ?Vendor</s>
			<s>isRegisteredIn ?TargetCountry ?Vendor</s>
		</body>
		<head>
			<s>placeOfPayingVATFor ?Selling ?TargetCountry</s>
		</head>
	</rule>
<!--	<rule id="fact_26"><s>isRegisteredIn Austria Vendor</s></rule> -->
	
	<rule id="placeOfPayingVAT_targetCountry_2">
		<body>
			<s>vendorOf ?Selling ?Vendor</s>
			<s>acquirerOf ?Selling ?Acquirer</s>
			<s>memberStateOf ?Acquirer ?TargetCountry</s>
			
			<s>totalSellingsOf ?Vendor ?TotalSellings</s> 
			<s>thresholdIn ?TargetCountry ?Threshold</s>
			
			<s>_isLiableForPayingVATFor ?Selling ?Vendor</s>
			<s>greaterOrEquals ?TotalSellings ?Threshold</s>
		</body>
		<head>
			<s>placeOfPayingVATFor ?Selling ?TargetCountry</s>
		</head>
	</rule>
	<rule id="fact_27"><s>totalSellingsOf Vendor 120000</s></rule>
	
	<rule id="greaterOrEquals">
		<body>
			<s>eval #t <s>>= ?x ?y</s></s>
		</body>
		<head>
			<s>greaterOrEquals ?x ?y</s>
		</head>
	</rule>
	<rule id="not_greaterOrEquals">
		<body>
			 <s>eval #f <s>>= ?x ?y</s></s>
		</body>
		<head>
			<not><s>greaterOrEquals ?x ?y</s></not>
		</head>
	</rule>
	
	<rule id="placeOfPayingVAT_sourceCountry">
		<body>
			<s>vendorOf ?Selling ?Vendor</s>
			<s>acquirerOf ?Selling ?Acquirer</s>
			<s>memberStateOf ?Acquirer ?TargetCountry</s>
			<s>memberStateOf ?Vendor ?SourceCountry</s>
			
			<s>totalSellingsOf ?Vendor ?TotalSellings</s>
			<s>thresholdIn ?TargetCountry ?Threshold</s>
		
			<s>_isLiableForPayingVATFor ?Selling ?Vendor</s>
			<not><s>isRegisteredIn ?TargetCountry ?Vendor</s></not>
			<not><s>greaterOrEquals ?TotalSellings ?Threshold</s></not>
		</body>
		<head>
			<s>placeOfPayingVATFor ?Selling ?SourceCountry</s>
		</head>
	</rule>
	
<!--	<rule id="fact_29"><s>totalSellingsOf Vendor 80000</s></rule> -->
<!--	<rule id="fact_30"><not><s>isRegisteredIn Austria Vendor</s></not></rule> -->

	<rule id="threshold_Austria"><s>thresholdIn Austria 100000</s></rule>
	<rule id="threshold_Belgium"><s>thresholdIn Belgium 5000</s></rule>
	<rule id="threshold_Ciprus"><s>thresholdIn Ciprus 34220</s></rule>
	<rule id="threshold_CzechRepublic"><s>thresholdIn CzechRepublic 35000</s></rule>
	<rule id="threshold_Denmark"><s>thresholdIn Denmark 37528</s></rule>
	<rule id="threshold_Estonia"><s>thresholdIn Estonia 35150</s></rule>
	<rule id="threshold_Finland"><s>thresholdIn Finland 35000</s></rule>
	<rule id="threshold_France"><s>thresholdIn France 100000</s></rule>
	<rule id="threshold_Germany"><s>thresholdIn Germany 100000</s></rule>
	<rule id="threshold_GreatBritain"><s>thresholdIn GreatBritain 109598</s></rule>
	<rule id="threshold_Greece"><s>thresholdIn Greece 35000</s></rule>
	<rule id="threshold_Hungary"><s>thresholdIn Hungary 35000</s></rule>
	<rule id="threshold_Ireland"><s>thresholdIn Ireland 35000</s></rule>
	<rule id="threshold_Italy"><s>thresholdIn Italy 27889</s></rule>
	<rule id="threshold_Latvia"><s>thresholdIn Latvia 36952</s></rule>
	<rule id="threshold_Lithuania"><s>thresholdIn Lithuania 36207</s></rule>
	<rule id="threshold_Luxemburg"><s>thresholdIn Luxemburg 100000</s></rule>
	<rule id="threshold_Malta"><s>thresholdIn Malta 35000</s></rule>
	<rule id="threshold_Netherlands"><s>thresholdIn Netherlands 100000</s></rule>
	<rule id="threshold_Poland"><s>thresholdIn Poland 35000</s></rule>
	<rule id="threshold_Portugal"><s>thresholdIn Portugal 31424</s></rule>
	<rule id="threshold_Slovakia"><s>thresholdIn Slovakia 35000</s></rule>
	<rule id="threshold_Slovenia"><s>thresholdIn Slovenia 35000</s></rule>
	<rule id="threshold_Spain"><s>thresholdIn Spain 35000</s></rule>
	<rule id="threshold_Sweden"><s>thresholdIn Sweden 35809</s></rule>
	
<!-- *********************************************************************** -->
<!-- PART III. - How much should he pay?                                     -->

	<!-- <rule id="fact_32"><s>_placeOfPayingVATFor Selling Austria</s></rule> -->

	<rule id="amountOfVAT">
		<body>
			<s>_placeOfPayingVATFor ?Selling ?Country</s>
			<s>rateOfVATIn ?Country ?Rate</s>
			<s>priceOf ?Selling ?Price</s>
			
			<s>eval ?Amount <s>* ?Rate ?Price</s></s>
		</body>
		<head>
			<s>amountOfVATFor ?Selling ?Amount</s>
		</head>
	</rule>
		
	<!-- <rule id="fact_33"><s>priceOf Selling 100</s></rule> -->
	
	<rule id="rate_Austria"><s>rateOfVATIn Austria .20</s></rule>
	<rule id="rate_Belgium"><s>rateOfVATIn Belgium .21</s></rule>
	<rule id="rate_Bulgaria"><s>rateOfVATIn Bulgaria .20</s></rule>
	<rule id="rate_Ciprus"><s>rateOfVATIn Ciprus .15</s></rule>
	<rule id="rate_CzechRepublic"><s>rateOfVATIn CzechRepublic .19</s></rule>
	<rule id="rate_Germany"><s>rateOfVATIn Germany .19</s></rule>
	<rule id="rate_Denmark"><s>rateOFVATIn Denmark .25</s></rule>
	<rule id="rate_Spain"><s>rateOFVATIn Spain .16</s></rule>
	<rule id="rate_Estonia"><s>rateOFVATIn Estonia .18</s></rule>
	<rule id="rate_France"><s>rateOFVATIn France .096</s></rule>
	<rule id="rate_Finnland"><s>rateOFVATIn Finnland .22</s></rule>
	<rule id="rate_GreatBritain"><s>rateOFVATIn GreatBritain .175</s></rule>
	<rule id="rate_Greece"><s>rateOFVATIn Greece .19</s></rule>
	<rule id="rate_Hungary"><s>rateOFVATIn Hungary .20</s></rule>
	<rule id="rate_Italy"><s>rateOFVATIn Italy .20</s></rule>
	<rule id="rate_Ireland"><s>rateOFVATIn Ireland .21</s></rule>
	<rule id="rate_Luxembourg"><s>rateOFVATIn Luxembourg .15</s></rule>
	<rule id="rate_Lithuania"><s>rateOFVATIn Lithuania .18</s></rule>
	<rule id="rate_Latvia"><s>rateOFVATIn Latvia .18</s></rule>
	<rule id="rate_Malta"><s>rateOFVATIn Malta .18</s></rule>
	<rule id="rate_Netherlands"><s>rateOFVATIn Netherlands .19</s></rule>
	<rule id="rate_Portugal"><s>rateOFVATIn Portugal .21</s></rule>
	<rule id="rate_Poland"><s>rateOFVATIn Poland .22</s></rule>
	<rule id="rate_Rumania"><s>rateOFVATIn Rumania .19</s></rule>
	<rule id="rate_Sweden"><s>rateOFVATIn Sweden .25</s></rule>
	<rule id="rate_Slovakia"><s>rateOFVATIn Slovakia .19</s></rule>
	<rule id="rate_Slovenia"><s>rateOFVATIn Slovenia .20</s></rule>
</lkif>
